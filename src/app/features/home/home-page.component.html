@if (!isLoading && !loadError) {
  <section class="home-page">
    <header class="home-hero card">
      <div class="home-hero__heading">
        <p class="home-hero__eyebrow">{{ 'home.overview' | translate }}</p>
        <h2 class="home-hero__title">
          {{ 'home.greeting' | translate:{ name: authUser?.name || ('home.guestName' | translate) } }}
        </h2>
        <p class="home-hero__subtitle">{{ 'home.subtitle' | translate }}</p>
      </div>
      <div class="home-hero__balance">
        <span class="label">{{ 'home.balance' | translate }}</span>
        <span class="amount" [class.positive]="totals.balance >= 0" [class.negative]="totals.balance < 0">
          {{ formatAmount(totals.balance) }}
        </span>
        <span class="diff">
          {{ totals.balance >= 0 ? '+' : '-' }}
          {{ formatAmount(netFlowAbsolute) }}
          Â· {{ 'home.balanceHint' | translate }}
        </span>
      </div>
    </header>

    <section class="home-summary">
      <article class="summary-card card">
        <div class="summary-card__icon summary-card__icon--income" aria-hidden="true">â¬†</div>
        <div class="summary-card__content">
          <p class="summary-card__label">{{ 'home.incomes' | translate }}</p>
          <p class="summary-card__amount">{{ formatAmount(totals.incomes) }}</p>
          <p class="summary-card__meta">{{ 'home.entriesCount' | translate:{ count: counts.incomes } }}</p>
        </div>
      </article>

      <article class="summary-card card">
        <div class="summary-card__icon summary-card__icon--expense" aria-hidden="true">â¬‡</div>
        <div class="summary-card__content">
          <p class="summary-card__label">{{ 'home.expenses' | translate }}</p>
          <p class="summary-card__amount">{{ formatAmount(totals.expenses) }}</p>
          <p class="summary-card__meta">{{ 'home.entriesCount' | translate:{ count: counts.expenses } }}</p>
        </div>
      </article>

      <article class="summary-card card">
        <div class="summary-card__icon summary-card__icon--savings" aria-hidden="true">ðŸ’°</div>
        <div class="summary-card__content">
          <p class="summary-card__label">{{ 'home.savingsRate' | translate }}</p>
          <p class="summary-card__amount">{{ totals.savingsRate | number:'1.0-0' }}%</p>
          <p class="summary-card__meta">{{ 'home.savingsHint' | translate }}</p>
        </div>
      </article>
    </section>

    <section class="home-insights card">
      <header class="home-insights__header">
        <div>
          <h3>{{ 'home.insights.title' | translate }}</h3>
          <p>{{ 'home.insights.subtitle' | translate }}</p>
        </div>
        <span class="home-insights__badge">
          {{ chartData.incomesPercent }}% / {{ chartData.expensesPercent }}%
        </span>
      </header>

      <div class="home-insights__chart">
        <div class="home-insights__bar">
          <div
            class="home-insights__segment home-insights__segment--income"
            [style.width.%]="chartData.incomesPercent"
          ></div>
          <div
            class="home-insights__segment home-insights__segment--expense"
            [style.width.%]="chartData.expensesPercent"
          ></div>
        </div>

        <div class="home-insights__legend">
          <div class="home-insights__legend-item">
            <span class="dot dot--income"></span>
            <div>
              <p>{{ 'home.insights.incomeLabel' | translate }}</p>
              <small>{{ chartData.incomesPercent }}% Â· {{ formatAmount(totals.incomes) }}</small>
            </div>
          </div>

          <div class="home-insights__legend-item">
            <span class="dot dot--expense"></span>
            <div>
              <p>{{ 'home.insights.expenseLabel' | translate }}</p>
              <small>{{ chartData.expensesPercent }}% Â· {{ formatAmount(totals.expenses) }}</small>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="home-transactions card">
      <header class="home-transactions__header">
        <h3>{{ 'home.recentTransactions' | translate }}</h3>
        <a class="home-transactions__link" routerLink="/incomes">{{ 'home.viewAll' | translate }}</a>
      </header>

      @if (recentTransactions.length) {
        <ul class="transaction-list">
          <li
            class="transaction-item"
            *ngFor="let tx of recentTransactions"
            [class.transaction-item--income]="tx.type === 'income'"
            [class.transaction-item--expense]="tx.type === 'expense'"
          >
            <div class="transaction-item__icon" aria-hidden="true">
              <span *ngIf="tx.type === 'income'">â¬†</span>
              <span *ngIf="tx.type === 'expense'">â¬‡</span>
            </div>

            <div class="transaction-item__details">
              <p class="transaction-item__title">{{ tx.description }}</p>
              <p class="transaction-item__meta">
                {{ tx.category }} Â· {{ formatDate(tx.date) }}
              </p>
            </div>

            <div class="transaction-item__amount">
              <span>{{ formatAmount(tx.type === 'income' ? tx.amount : -tx.amount, true) }}</span>
            </div>
          </li>
        </ul>
      } @else {
        <p class="home-transactions__empty">
          {{ 'home.emptyTransactions' | translate }}
        </p>
      }
    </section>
  </section>
} @else {
  <div class="home-state">
    @if (isLoading) {
      <div class="home-state__message">
        <span class="spinner" aria-hidden="true"></span>
        <p>{{ 'home.loading' | translate }}</p>
      </div>
    } @else {
      <div class="home-state__message">
        <p>{{ loadError | translate }}</p>
        <button type="button" class="btn btn--primary" (click)="reload()">
          {{ 'home.tryAgain' | translate }}
        </button>
      </div>
    }
  </div>
}
